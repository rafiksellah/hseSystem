<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DÃ©tails SirÃ¨ne - {{ sirene.zone }}</title>
    <style>
        body {font-family: Arial, sans-serif; font-size: 12px; margin: 20px;}
        .header {text-align: center; margin-bottom: 30px; border-bottom: 3px solid #ffc107; padding-bottom: 10px;}
        .header h1 {color: #ffc107; margin: 5px 0; font-size: 24px;}
        .section {margin-bottom: 25px;}
        .section-title {background-color: #ffc107; color: white; padding: 8px; font-weight: bold; margin-bottom: 10px;}
        table {width: 100%; border-collapse: collapse; margin-bottom: 15px;}
        table th {background-color: #f8f9fa; padding: 8px; text-align: left; border: 1px solid #dee2e6; font-weight: bold; width: 35%;}
        table td {padding: 8px; border: 1px solid #dee2e6;}
        .badge {display: inline-block; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 11px;}
        .badge-success {background-color: #28a745; color: white;}
        .badge-danger {background-color: #dc3545; color: white;}
        .badge-secondary {background-color: #6c757d; color: white;}
        .footer {margin-top: 40px; text-align: center; font-size: 10px; color: #6c757d; border-top: 1px solid #dee2e6; padding-top: 10px;}
        .inspections-table {font-size: 10px;}
        .inspections-table th {background-color: #e9ecef; font-size: 10px;}
        .inspections-table td {font-size: 10px;}
    </style>
</head>
<body>
    <div class="header">
        <h1>DÃ‰TAILS SIRÃˆNE</h1>
        <p style="margin: 5px 0; color: #6c757d;">{{ sirene.zone }} - {{ sirene.emplacement ?? sirene.numerotation }}</p>
        <p style="margin: 5px 0; font-size: 11px;">Ã‰ditÃ© le {{ "now"|date('d/m/Y Ã  H:i') }}</p>
    </div>

    <div class="section">
        <div class="section-title">ðŸ”” INFORMATIONS GÃ‰NÃ‰RALES</div>
        <table>
            <tr><th>Zone :</th><td>{{ sirene.zone }}</td></tr>
            <tr><th>Emplacement :</th><td>{{ sirene.emplacement ?? '-' }}</td></tr>
            <tr><th>NumÃ©rotation :</th><td><strong>{{ sirene.numerotation }}</strong></td></tr>
            <tr><th>Type :</th><td>{{ sirene.type ?? '-' }}</td></tr>
            <tr><th>Date de crÃ©ation :</th><td>{{ sirene.dateCreation|date('d/m/Y Ã  H:i') }}</td></tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">ðŸ“Š Ã‰TAT ET INSPECTIONS</div>
        <table>
            <tr>
                <th>Ã‰tat actuel :</th>
                <td>
                    {% set conformite = sirene.statutConformite %}
                    {% if conformite == 'Conforme' %}
                        <span class="badge badge-success">âœ“ CONFORME</span>
                    {% elseif conformite == 'Non conforme' %}
                        <span class="badge badge-danger">âœ— NON CONFORME</span>
                    {% else %}
                        <span class="badge badge-secondary">? NON INSPECTÃ‰</span>
                    {% endif %}
                </td>
            </tr>
            <tr><th>Nombre total d'inspections :</th><td><strong>{{ sirene.nombreInspections }}</strong></td></tr>
            {% set derniere = sirene.derniereInspection %}
            {% if derniere %}
            <tr><th>DerniÃ¨re inspection :</th><td>{{ derniere.dateInspection|date('d/m/Y Ã  H:i') }}</td></tr>
            <tr><th>InspectÃ©e par :</th><td>{{ derniere.inspectePar.fullName }}</td></tr>
            <tr>
                <th>RÃ©sultat derniÃ¨re inspection :</th>
                <td>
                    {% if derniere.valide %}
                        <span class="badge badge-success">âœ“ CONFORME</span>
                    {% else %}
                        <span class="badge badge-danger">âœ— NON CONFORME</span>
                    {% endif %}
                </td>
            </tr>
            {% endif %}
        </table>
    </div>

    {% if sirene.inspections|length > 0 %}
    <div class="section">
        <div class="section-title">ðŸ“‹ HISTORIQUE DES INSPECTIONS</div>
        <table class="inspections-table">
            <thead>
                <tr><th>Date</th><th>Inspecteur</th><th>RÃ©sultat</th><th>CritÃ¨res OK</th><th>Observations</th></tr>
            </thead>
            <tbody>
                {% for inspection in sirene.inspections|sort((a, b) => b.dateInspection <=> a.dateInspection) %}
                <tr>
                    <td>{{ inspection.dateInspection|date('d/m/Y H:i') }}</td>
                    <td>{{ inspection.inspectePar.fullName }}</td>
                    <td>
                        {% if inspection.valide %}
                            <span class="badge badge-success">âœ“ OK</span>
                        {% else %}
                            <span class="badge badge-danger">âœ— NOK</span>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">
                        {{ inspection.criteres|length }}/{{ constant('App\\Entity\\InspectionSirene::CRITERES')|length }}
                    </td>
                    <td>{{ inspection.observations|default('-')|u.truncate(100, '...') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <div class="footer">
        <p><strong>Document gÃ©nÃ©rÃ© automatiquement</strong></p>
        <p>SirÃ¨ne - {{ sirene.zone }} - {{ sirene.emplacement ?? sirene.numerotation }}</p>
        <p>Date d'Ã©dition : {{ "now"|date('d/m/Y Ã  H:i') }}</p>
    </div>
</body>
</html>

